<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>파일 공유하기</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
    <h2>파일 공유하기</h2>
    
    <ul id="file-list">
        <!-- 파일 목록이 여기에 동적으로 추가됨 -->
    </ul>

    <div id="share-section" style="display: none;">
        <p>공유 링크: <a id="share-link" href="#" target="_blank"></a></p>
        <button onclick="copyLink()">복사하기</button>
    </div>

    <script>
        async function fetchFiles() {
            const response = await axios.post("http://localhost:8080/getFiles", {userId : "이승우"}); // 파일 목록 가져오기
            const files = response.data;

            console.log(files);

            const fileList = document.getElementById('file-list');
            fileList.innerHTML = '';

            files.forEach(file => {
                const listItem = document.createElement('li');
                listItem.textContent = file.fileName + " ";
                
                const shareButton = document.createElement('button');
                shareButton.textContent = "공유하기";
                shareButton.onclick = () => shareFile(file.userId, file.fileId);

                listItem.appendChild(shareButton);
                fileList.appendChild(listItem);
            });
        }

        async function shareFile(userId, fileId) {
            const response = await axios.post('http://localhost:8080/share/create', {userId, fileId});


            const data = response.data;

            document.getElementById('share-link').href = data;
            document.getElementById('share-link').textContent = data;
            document.getElementById('share-section').style.display = "block";
        }

        function copyLink() {
            const link = document.getElementById('share-link').href;
            navigator.clipboard.writeText(link);
            alert("링크가 복사되었습니다!");
        }

        // 페이지 로드 시 파일 목록 불러오기
        fetchFiles();
    </script>
</body>
</html>
