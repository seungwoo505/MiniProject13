<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>여러 파일 드래그 앤 업로드 테스트</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    #dropZone {
      border: 2px dashed #007bff;
      border-radius: 5px;
      padding: 30px;
      text-align: center;
      color: #007bff;
      font-size: 1.2em;
      margin-bottom: 20px;
    }
    #dropZone.hover {
      background-color: #e9f5ff;
    }
  </style>
</head>
<body>
  <div class="container mt-4">
    <h1>여러 파일 드래그 앤 업로드 테스트</h1>
    
    <!-- 파일 ID 입력 -->
    <div class="form-group">
      <label for="fileId">파일 ID:</label>
      <input type="text" id="fileId" class="form-control" placeholder="업데이트할 파일 ID">
    </div>
    
    <!-- 새 파일 이름 접두사 입력 -->
    <div class="form-group">
      <label for="newFileName">새 파일 이름 (접두사):</label>
      <input type="text" id="newFileName" class="form-control" placeholder="예: new_file">
    </div>
    
    <!-- 드래그 앤 드롭 영역 -->
    <div id="dropZone">
      여기에 파일을 드래그 앤 드롭하세요.
    </div>
    
    <!-- 파일 선택 input (다중 선택 가능) -->
    <div class="form-group">
      <label for="fileInput">또는 파일 선택:</label>
      <input type="file" id="fileInput" class="form-control-file" multiple>
    </div>
    
    <!-- 파일 업데이트 버튼 -->
    <button id="uploadBtn" class="btn btn-primary">파일 업데이트</button>
    
    <!-- 결과 메시지 영역 -->
    <div id="result" class="mt-3"></div>
  </div>
  
  <!-- axios CDN -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    let droppedFiles = [];
    
    const dropZone = document.getElementById('dropZone');
    
    // 드래그 앤 드롭 이벤트 기본 동작 방지
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      dropZone.addEventListener(eventName, e => {
        e.preventDefault();
        e.stopPropagation();
      }, false);
    });
    
    // 드래그 오버 시 스타일 변경
    dropZone.addEventListener('dragover', () => {
      dropZone.classList.add('hover');
    }, false);
    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('hover');
    }, false);
    
    // 파일 드롭 시 처리: 여러 파일을 배열에 저장
    dropZone.addEventListener('drop', (e) => {
      dropZone.classList.remove('hover');
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        droppedFiles = Array.from(files);
        // 드롭된 파일들의 이름을 보여줍니다.
        const fileNames = droppedFiles.map(file => file.name).join(', ');
        dropZone.textContent = "선택된 파일들: " + fileNames;
      }
    }, false);
    
    // 파일 업데이트 버튼 클릭 시 처리
    document.getElementById('uploadBtn').addEventListener('click', () => {
      const fileId = document.getElementById('fileId').value.trim();
      const newFileNamePrefix = document.getElementById('newFileName').value.trim();
      const fileInput = document.getElementById('fileInput');
      
      // 드래그 앤 드롭된 파일이 있으면 사용하고, 없으면 fileInput에서 선택한 파일들을 사용
      let filesToUpload = droppedFiles.length > 0 ? droppedFiles : (fileInput.files.length > 0 ? Array.from(fileInput.files) : []);
      
      if (/*!fileId ||*/ filesToUpload.length === 0) {
        alert("파일 ID, 새 파일 이름(접두사) 및 파일을 선택하세요.");
        return;
      }
      
      // FormData 생성: 여러 파일을 하나씩 추가

      filesToUpload.forEach(async (file, index) => {
        // 예시: 새로운 파일 이름은 접두사 + "_" + 순번 + 확장자로 생성
        const formData = new FormData();

        formData.append("file", file);
        formData.append("userId", "이승우");
        //formData.append("fileId", fileId);

        // 서버의 API 엔드포인트 (예시: PUT /api/files/{fileId}/multiple)
        await axios.post("http://localhost:8080/upload", formData)
        .then(response => {
            document.getElementById('result').innerHTML = `<div class="alert alert-success">업데이트 성공: ${response.data}</div>`;
        })
        .catch(error => {
            console.error(error);
            const errorMsg = error.response && error.response.data ? error.response.data : error.message;
            document.getElementById('result').innerHTML = `<div class="alert alert-danger">업데이트 실패: ${errorMsg}</div>`;
        });

      });
    });
  </script>
</body>
</html>
